@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    ul.KL{
        list-style: none;
        text-align: justify;
    }
    /* Đảm bảo rằng div kết quả có chiều cao phù hợp */
    .Sym-container {
        background-color: rgba(255, 255, 255, 0.1); /* Màu nền để dễ nhìn */
        padding: 20px; /* Thêm padding cho đẹp */
        border-radius: 10px; /* Bo góc cho div */
        margin-top: -120px;
        height: 160px;
        overflow-y: auto;
    }

    .diagnosis-container {
        max-height: calc(60vh - 25px); /* Chiều cao tối đa cho khung triệu chứng */
        overflow-y: auto; /* Cho phép cuộn nếu nội dung vượt quá chiều cao */
    }
</style>
<div class="row">
    <div class="col-5">
        <h3 class="text-white">Chọn triệu chứng bạn đang gặp phải</h3>
        <div class="diagnosis-container">
        <form method="post" action="/Diagnosis/Result">
            <div class="pt-3 m-auto alert-heading text-monospace text-left">
                <table class="table table-bordered text-white">
                    <thead>
                        <tr>
                            <th></th>
                            <th class="align-content-center text-center">Triệu chứng</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.Sys != null)
                        {
                            @foreach (var symptom in ViewBag.Sys)
                            {
                                <tr>
                                    <td>
                                        <input type="checkbox" name="SelectedSymptoms" value="@symptom.IdSym" />
                                    </td>
                                    <td>
                                        @symptom.NameSym
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="2">Không có triệu chứng nào để hiển thị.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <button class="btn btn-outline-light w-100" type="submit">Chuẩn đoán</button>
        </form>
        </div>
    </div>
    <div class="col-7">
        <h3 class="text-white">Kết quả chuẩn đoán</h3>
        <div id="resultContainer" class="result-container">
            @Html.Partial("View")
        </div>
    </div>
    <div class="Sym-container col-5 text-white">
        <h4 class="text-white">Kết luận</h4>
        @if (ViewBag.FullMatchDiseases != null)
        {

            <ul class="KL">
                @foreach (var fullMatch in ViewBag.FullMatchDiseases)
                {
                    <li>@fullMatch</li>
                }
            </ul>
        }
        else
        {
            <div>
                Chưa xác định được bệnh
            </div>
        }
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function redirectToView() {
            loadSymptomDetail();
        }

        function loadSymptomDetail() {
            // Lấy danh sách các triệu chứng đã chọn
            const selectedSymptoms = $('input[name="SelectedSymptoms"]:checked').map(function () {
                return $(this).val();
            }).get();

            // Gửi yêu cầu AJAX
            $.ajax({
                url: '/Diagnosis/Result',
                type: 'POST',
                data: { selectedSymptoms: selectedSymptoms },  // Truyền danh sách triệu chứng đã chọn
                success: function (result) {
                    $('#resultContainer').html(result); // Cập nhật kết quả vào container
                },
                error: function (xhr, status, error) {
                    alert("Đã xảy ra lỗi: " + error);
                }
            });
        }
    </script>
